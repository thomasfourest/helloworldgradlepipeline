/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java Library project to get you started.
 * For more details take a look at the Java Libraries chapter in the Gradle
 * User Manual available at https://docs.gradle.org/5.3.1/userguide/java_library_plugin.html
 */

plugins {
    // Apply the java-library plugin to add support for Java Library
    id 'java-library'
    id 'maven'
    id 'net.nemerosa.versioning' version '2.6.1'
    id 'net.researchgate.release' version '2.6.0'
    
}

/*
> Task :compileJava FAILED
Task ':compileJava' is not up-to-date because:
  Task has failed previously.
All input files are considered out-of-date for incremental task ':compileJava'.
Full recompilation is required because no incremental change information is available. This is usually caused by clean builds or changing compiler arguments.
Compiling with JDK Java compiler API.
C:\Users\tft\Desktop\helloworldgradlepipeline\src\main\java\com\devops\MyHello.java:3: error: package org.apache.log4j does not exist
import org.apache.log4j.Logger;
                       ^
C:\Users\tft\Desktop\helloworldgradlepipeline\src\main\java\com\devops\MyHello.java:7: error: cannot find symbol
        final static Logger logger = Logger.getLogger(MyHello.class);
                     ^
  symbol:   class Logger
  location: class MyHello
C:\Users\tft\Desktop\helloworldgradlepipeline\src\main\java\com\devops\MyHello.java:7: error: cannot find symbol
        final static Logger logger = Logger.getLogger(MyHello.class);
                                     ^
  symbol:   variable Logger
  location: class MyHello
3 errors
:compileJava (Thread[Execution worker for ':',5,main]) completed. Took 0.116 secs.

FAILURE: Build failed with an exception.
*/

repositories {
    // Use jcenter for resolving your dependencies.
    // You can declare any Maven/Ivy/file repository here.
    jcenter()

    mavenCentral()
//    maven {
//	url "http://nexus.itnsa.net/content/groups/public/"
//    }
}

dependencies {
    // This dependency is exported to consumers, that is to say found on their compile classpath.
    //sample
    api 'org.apache.commons:commons-math3:3.6.1'
//    api 'com.google.guava:guava:23.0'
    
    // This dependency is used internally, and not exposed to consumers on their own compile classpath.
    //sample
    implementation 'com.google.guava:guava:27.0.1-jre'

    implementation 'log4j:log4j:1.2.17'
    
    // Use JUnit test framework
    //testImplementation 'junit:junit:4.12'
    testImplementation 'junit:junit:4.+'
}

//jar {
//    baseName "package.name.of.jar"
//}

jar {
    manifest {
        attributes(
            'Built-By'       : System.properties['user.name'],
            'Build-Timestamp': new java.text.SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss.SSSZ").format(new Date()),
            'Build-Revision' : versioning.info.commit,
            'Created-By'     : "Gradle ${gradle.gradleVersion}",
            'Build-Jdk'      : "${System.properties['java.version']} (${System.properties['java.vendor']} ${System.properties['java.vm.version']})",
            'Build-OS'       : "${System.properties['os.name']} ${System.properties['os.arch']} ${System.properties['os.version']}"
        )
    }
}

uploadArchives {
    repositories {
//maven-publishing plugin	
	  maven {
        def releasesRepoUrl = "http://7kwdf02/nexus/content/repositories/repoIndustrialisationRelease/"
        def snapshotsRepoUrl = "http://7kwdf02/nexus/content/repositories/repoIndustrialisationSnapshot/"
        url version.endsWith("SNAPSHOT") ? snapshotsRepoUrl : releasesRepoUrl
		credentials {
          username = 'itn-deployer'
          password = '21954971a9'
        }
      }
/* maven plugin 
       mavenDeployer {
         repository(url: "http://7kwdf02/nexus/content/repositories/repoIndustrialisationRelease/") {
           authentication(userName: "itn-deployer", password: "21954971a9")
         }
		 snapshotRepository(url: "http://7kwdf02/nexus/content/repositories/repoIndustrialisationSnapshot/") {
           authentication(userName: "itn-deployer", password: "21954971a9")
         }
       }
*/
    }
}


// default configuration of the release plugin ofr gradle
/*
release {
    failOnCommitNeeded = true
    failOnPublishNeeded = true
    failOnSnapshotDependencies = true
    failOnUnversionedFiles = true
    failOnUpdateNeeded = true
    revertOnFail = true
    preCommitText = ''
    preTagCommitMessage = '[Gradle Release Plugin] - pre tag commit: '
    tagCommitMessage = '[Gradle Release Plugin] - creating tag: '
    newVersionCommitMessage = '[Gradle Release Plugin] - new version commit: '
    tagTemplate = '${version}'
    versionPropertyFile = 'gradle.properties'
    versionProperties = []
    buildTasks = ['build']
    ignoredSnapshotDependencies = []
    versionPatterns = [
        /(\d+)([^\d]*$)/: { Matcher m, Project p -> m.replaceAll("${(m[0][1] as int) + 1}${m[0][2]}") }
    ]
    pushReleaseVersionBranch = false
    scmAdapters = [
        net.researchgate.release.GitAdapter,
        net.researchgate.release.SvnAdapter,
        net.researchgate.release.HgAdapter,
        net.researchgate.release.BzrAdapter
    ]

    git {
        requireBranch = 'master'
        pushToRemote = 'origin'
        pushToBranchPrefix = ''
        commitVersionFileOnly = false
        signTag = false
    }

    svn {
        username = null
        password = null
        pinExternals = false   // allows to pin the externals when tagging, requires subversion client >= 1.9.0
    }

}
*/
